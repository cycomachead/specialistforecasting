<apex:page showHeader="true" cache="false" tabStyle="SpecialistForecastTab__tab" id="pg"  controller="SpecialistForecastController" title="Specialist Forecast">
      
  <style type="text/css">
  .sumRow {
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
    }

    .dataRow {
        text-align: center;
        vertical-align: middle;
    }

    .apexp .detailList .list td, .apexp .detailList .list th, .apexp .editPage .bPageBlock .detailList .list tr td, .apexp .editPage .bPageBlock .detailList .list tr th {
        padding: 4px 5px;
        white-space: nowrap;
    }

    .apexp .detailList .list .headerRow th {
        border-bottom: 0 solid #CCCCCC;
        text-align: center;
        vertical-align: middle;
        white-space: pre-wrap;
    }

    /* Cascade over default table styling */    
    body .pbBody table.list tr.dataRow th, body .pbBody table.list tr.dataRow td {
        border-width: 1px;
        vertical-align: middle;
    }

    body .bRelatedList .pbBody table.list, body .apexp .pbBody table.list {
        border: 1px solid #D4DADC;
        margin-bottom: -0.3em;
    }

    body .bDetailBlock.bPageBlock .pbBody .labelCol, body .bDetailBlock.bPageBlock .pbBody .dataCol, body .bDetailBlock.bPageBlock .pbBody .data2Col, body .bPageBlock.bEditBlock .pbBody .labelCol, body .bPageBlock.bEditBlock .pbBody .dataCol, body .bPageBlock.bEditBlock .pbBody .data2Col {
        padding-top: 0;
        padding-bottom: 0;
        border-bottom: 0;
    }
    
    .topTable {
        border-style: solid;
    }
    
    .topTable th {
        background: url("/img/alohaSkin/grid_headerbg.gif") repeat-x scroll 0 bottom #FFFFFF;
        border-style: solid;
        border-width: 1px;
        padding: .5em;
        text-align: center;
        font-size: 0.9em;
        padding: 1px;
        height:30px;
        cellspacing:2px;       
    }

    .topTable tr td {
        border-style: solid;
        border-width: 1px;
        height:20px;

    }
    
    .leftCol {
        font-weight: bold;
        text-align: left;
    }
    
   
        .custPopup{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 50%;
            padding:10px;
            position: absolute;
            /* These are the 3 css properties you will need to change so the popup 
            displays in the center of the screen. First set the width. Then set 
            margin-left to negative half of what the width is. You can add 
            the height property for a fixed size pop up if you want.*/
            width: 500px;
            margin-left: -250px;
            top:100px;
        }
        .popupBackground{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
        }
         .custPopupDrilDown{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 50%;
            padding:10px;
            position: absolute;
            width: 1100px;
            margin-left: -450px;
            top:50px;
        }
        .popupBackgroundDrilDown{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
        }
    </style>
  
   <apex:form id="spforecastForm"> 
        <apex:actionfunction name="callMethod" action="{!viewSpecialistReport}"/>
        <img title="Custom Forecast" class="pageTitleIcon" src="/img/s.gif"/>
      
        <apex:outputPanel id="ovrpopup">
            <apex:outputPanel styleClass="popupBackground" layout="block" rendered="{!displayPopUp}"/>
            <apex:outputPanel styleClass="custPopup" layout="block" rendered="{!displayPopUp}">
           
             <apex:pageBlock id="pb">
             <apex:pagemessages />
            <apex:pageBlockSection collapsible="false" title="Override the Original Amount"  id="pbs">
                 <apex:panelGrid columns="2"  id="pbsg">
                       <apex:Outputtext value="Original Amount" />
                        <apex:outputText value="{0, number, $###,##0.00}">
                          <apex:param value="{!originalAmount}"/>
                        </apex:outputText>
                        <apex:Outputtext value="Override Amount" />
                        <apex:inputtext id="Originaloverrideamount" value="{!overrideAmount}"/>
                        <apex:Outputtext value="Comments" />
                        <apex:inputTextarea id="Originaloverridecomment"  value="{!overrideComment}"/>
                      <apex:actionStatus startText="ProcessingTheStuff" id="counterStatus">
                                   <apex:facet name="start" >
                                            <apex:commandButton Id="overrideamnt" title="Override Amount" value="Update" disabled="true" action="{!saveOverride}" >
                                            <img src="/apexpages/devmode/img/saveStatus.gif" />
                                            </apex:commandButton>
                                    </apex:facet>
                                    <apex:facet name="stop">
                                        <!--apex:commandButton Id="overrideamnts" title="Override Amount on Specialist Forecast Report" onclick="if(refreshParent()==false) return false;" value="Update" action="{!saveOverride}"  oncomplete="refreshParent();" status="counterStatus" rerender="pb" /-->
                                         <apex:commandButton Id="overrideamnts" title="Override Amount on Specialist Forecast Report"  value="Update" action="{!saveOverride}"  status="counterStatus" rerender="pb" />
                                   
                                    </apex:facet>
                                </apex:actionStatus>
                                <apex:commandButton id="canceloverrideamnt"  title="Close the window and refresh parent" value="Close"  action="{!closeOverridePopup}"/>
                </apex:panelGrid>

            </apex:pageBlockSection>
        </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>
        
      <!--*********Drilldown Popup **********************-->
       <apex:outputPanel id="drldwnpopup">
            <apex:outputPanel styleClass="popupBackgroundDrilDown" layout="block" rendered="{!displayDrilDownPopup }"/>
            <apex:outputPanel styleClass="custPopupDrilDown" layout="block" rendered="{!displayDrilDownPopup }">
                   
              <apex:pageBlock id="pbdrl">
                   <apex:pagemessages />
                   <apex:outputPanel >
                          <apex:commandButton Id="close" title="Close Specialist Forecast data" value="Close"  action="{!closeDrilDownPopup}" />
                   </apex:outputPanel>
               
                    
                    <apex:pageBlockSection collapsible="false" title="List Forecast" columns="3" id="pgBlockSectiondrldwn">
                        <apex:dataTable styleClass="topTable" id="forecastRows" border="1" value="{!SpecialistforecastList}" var="forecast" width="1000">
                             <apex:column >
                                 <apex:facet name="header">
                                  <apex:outputText value="Opportunity" />    
                                  </apex:facet>  
                                  <apex:outputlink style="white-space:pre-wrap; float: left;" rendered="{!forecast.Opportunity__c!=null}" value="../{!forecast.Opportunity__c}" target="_blank" >{!forecast.Opportunity__r.Name}</apex:outputLink>
                             </apex:column>
                             
                                                        
                             <apex:column >
                                 <apex:facet name="header">
                                    <apex:outputText style="white-space:pre-wrap; float: right; height:20px;width:130px" value="Specialist AE Opportunity Amount" />         
                                 </apex:facet>
                                 <apex:outputText style="float: right;" value="${0, number,###,###,###,##0.00}">
                                        <apex:param value="{!forecast.ForecastAmount__c}" />
                                     </apex:outputText> 
                                   
                             </apex:column>
        
                             <apex:column >
                                 <apex:facet name="header">
                                    <apex:outputText value="Status" />          
                                 </apex:facet>  
                                 <apex:outputText value="{!forecast.ForecastStatus__c}"/>
                                 
                             </apex:column>
                              <apex:column >
                                 <apex:facet name="header">
                                    <apex:outputText value="Month" />          
                                 </apex:facet>  
                                 <apex:outputText value="{!forecast.FYMonth__c}"/>
                              </apex:column>
                              <apex:column >
                                 <apex:facet name="header">
                                    <apex:outputText value="Year" />          
                                 </apex:facet>  
                                 <apex:outputText value="{!forecast.FiscalYear__c}" />
                              </apex:column>
                             <apex:column >
                                 <apex:facet name="header">
                                    <apex:outputText style="height:20px;width:110px" value="Stage" />          
                                 </apex:facet>  
                                 <apex:outputText rendered="true" value="{!forecast.ForecastStage__c}"/>
                             </apex:column>
                            
                             <apex:column >
                                 <apex:facet name="header">
                                    <apex:outputText value="Close Date" />         
                                 </apex:facet>
                                 
                                 <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                    <apex:param value="{!forecast.ForecastCloseDate__c}" />
                                 </apex:outputText>
                                     
                             </apex:column>
                        </apex:dataTable>
         
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>
        
      
      <!--************Drildownpopup End *****************-->
    

     <apex:pageBlock rendered="true" title="Specialist Forecast"  id="pgBlock">
          <apex:pageMessages />
           <apex:pageBlockSection collapsible="false" title="Find a Forecast"  id="pgBlockSection1" >
             
                <apex:outputPanel rendered="true" id="dataId3"  style="">
                    <apex:inputField style="font-weight:bold" value="{!sfLI.ForecastOwner__c}" id="txtUsr"  />
                </apex:outputPanel>
                
                <apex:outputPanel rendered="true" id="fiscalYear">
                    <b>Fiscal Year&nbsp;</b>
                    <apex:selectList value="{!selectedFY}"  multiselect="false" size="1">
                        <apex:selectOptions value="{!fiscalYears}" />
                    </apex:selectList>
                    
                    <b>&nbsp;Fiscal Quarter&nbsp;</b>
                    <apex:selectList value="{!selectedFQ}"  multiselect="false" size="1">
                        <apex:selectOptions value="{!fiscalQuarters}" />
                    </apex:selectList>
                     <apex:actionStatus startText="ProcessingTheStuff" id="counterStatus">
                       <apex:facet name="start" >
                                <apex:commandButton Id="processReport" title="View Report" value="ViewReport" disabled="true" action="{!viewSpecialistReport}">
                                <img src="/apexpages/devmode/img/saveStatus.gif" />
                                </apex:commandButton>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:commandButton Id="viewReport" title="View Specialist Forecast Report" value="View Report" action="{!viewSpecialistReport}" status="counterStatus" rerender="pgBlock" />
                        </apex:facet>
                    </apex:actionStatus>
                </apex:outputPanel>
               
                <apex:outputPanel rendered="true" id="dataId6">
                        <apex:outputText value=" " />
                          <apex:commandButton rendered="{!(canSubmit)}"  Id="SubmitReport" title="Submit Report" value="Submit" action="{!submitReport}" status="counterStatus" rerender="" />
                          <apex:commandButton rendered="{!(viewAccessToSyncButton)}"  Id="RefreshReportNow" title="Refresh report data now" value="Refresh Now" action="{!refreshSpecialistForecastDataNow}" status="counterStatus" rerender="" />
                      
                     </apex:outputPanel>
           </apex:pageBlockSection>
           
            
            <apex:pageBlockSection collapsible="false" title="{!PreparedByUser}'s Forecast" columns="3" id="pgBlockSection2">
                <apex:dataTable styleClass="topTable" id="forecastRows" border="1" value="{!SpecialistforecastLineItemsData}" var="forecast"  width="1100">
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color: #5C94BE;color:white;font-weight:bold;', '')}">
                         <apex:facet name="header">
                          <apex:outputText value="User(Role)" />    
                         </apex:facet>    
                         <apex:outputText rendered="{!(forecast.withoutLink)}"  style="white-space:nowrap;text-align: center;" value="{!forecast.UserRoleName}"/>
                         <apex:commandLink rendered="{!NOT(forecast.withoutLink)}" value="{!forecast.UserRoleName}" action="{!reportDrildownByUser_Role}"  >
                            <apex:param name="userId"  value="{!forecast.UserId}"  assignTo="{!selectedUserId}"/>
                         </apex:commandLink> 
                         <apex:outputPanel rendered="{!(forecast.isSubmitted)}">
                            <apex:image title="submitted on {!forecast.SubmittedDate}" url="{!$Resource.SpecialistForecastSubmitIcon}" width="15" height="15"/> 
                         </apex:outputpanel>           
                                   
                     </apex:column>
                     
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;', '')}" >
                         <apex:facet name="header">
                          <apex:outputText style="white-space:pre-wrap; float: right;width:100px" value="Closed " />         
                         </apex:facet>  
                        <apex:outputText style="white-space:nowrap;float: right;" rendered="{!NOT(forecast.searchUser && forecast.closedAmount>0)}" value="${0, number,###,###,###,##0.00}">
                               <apex:param value="{!forecast.closedAmount}" />
                         </apex:outputText>
                         <apex:commandLink rendered="{!(forecast.searchUser && forecast.closedAmount>0)}"  action="{!showDrilDownPopup}" rerender="drldwnpopup" >
                               <apex:outputText style="text-decoration: underline;float: right;" value="${0, number,###,###,###,##0.00}">
                                <apex:param value="{!forecast.closedAmount}"/>
                             </apex:outputText>
                              <apex:param name="lineowner1"  value="{!forecast.UserId}"  assignTo="{!lineItemownerID}"/>                                        
                              <apex:param name="ovrType2"  value="Closed"  assignTo="{!strField}"/>
                         </apex:commandLink>
                        
                     </apex:column>
                    
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;', '')}">
                         <apex:facet name="header">
                            <apex:outputText value="My Commit" />         
                         </apex:facet>
                         <span style="float:right;">
                             <apex:outputPanel rendered="{!(forecast.MycommitOverriden)}">
                                 <img title="{!forecast.mgrCommitOverrideNotes}" src="/img/mgr_override.gif"/>
                             </apex:outputpanel>
                             
                             <apex:outputPanel id="refPnl">
                                  <apex:outputText style="white-space:nowrap;text-align: right;" value="${0, number,###,###,###,##0.00}">
                                    <apex:param value="{!forecast.commitOverrideAmount}"/>
                                 </apex:outputText> 
                                 <apex:commandLink style="float: right;"  action="{!showOverridePopup}" rendered="{!(forecast.forOverride)}" rerender="ovrpopup">
                                    <img src="/img/forecast_edit_off.gif" alt="Click to Override (New Window)" width="25" height="16" title="Click to Override (New Window)"/>    
                                    <apex:param name="orgamt"  value="{!forecast.commitOverrideAmount}"  assignTo="{!originalAmount}"/>
                                    <apex:param name="orgOldamt"  value="{!forecast.commitAmount}"  assignTo="{!originaloldAmount}"/>
                                    <apex:param name="lineitem"  value="{!forecast.strLineItmId}"  assignTo="{!strRecordId}"/>
                                    <apex:param name="lineowner"  value="{!forecast.UserId}"  assignTo="{!lineItemownerID}"/>                                        
                                    <apex:param name="ovrType"  value="commit"  assignTo="{!strField}"/>
                                 </apex:commandLink>
                                 
                             </apex:outputPanel>
                         </span>
                     </apex:column>

                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;', '')}">
                         <apex:facet name="header">
                            <apex:outputText style="white-space:pre-wrap; float: right; height:20px;width:110px" value="My Direct Reports' Commit" />          
                         </apex:facet>      
    
                         <apex:outputText title="Previous Amount: ${!forecast.prevVFDirectRepCommitAmount}" style="white-space:nowrap;float: right;color:blue;font-weight:bold;" rendered="{!(NOT(forecast.searchUser&& forecast.commitAmount>0) &&(forecast.MycommitOverriden && forecast.commitPreviousAmountMatch))}" value="${0, number,###,###,###,##0.00}">
                            <apex:param value="{!forecast.commitAmount}"/>
                         </apex:outputText>
                         <apex:outputText style="white-space:nowrap;float: right;" rendered="{!(NOT(forecast.searchUser&& forecast.commitAmount>0) && NOT(forecast.MycommitOverriden &&forecast.commitPreviousAmountMatch))}" value="${0, number,###,###,###,##0.00}">
                            <apex:param value="{!forecast.commitAmount}"/>
                         </apex:outputText>
                         <apex:commandLink rendered="{!(forecast.searchUser&& forecast.commitAmount>0)}"  action="{!showDrilDownPopup}" rerender="drldwnpopup" >
                               <apex:outputText style="text-decoration: underline;float: right;" value="${0, number,###,###,###,##0.00}">
                                    <apex:param value="{!forecast.commitAmount}"/>
                               </apex:outputText>
                              <apex:param name="lineowner1"  value="{!forecast.UserId}"  assignTo="{!lineItemownerID}"/>                                        
                              <apex:param name="ovrType2"  value="Commit"  assignTo="{!strField}"/>
                          </apex:commandLink>
                          
                     </apex:column>
                    
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;', '')}" >
                         <apex:facet name="header">
                            <apex:outputText value="My Best Case" />         
                         </apex:facet>
                         <span style="float:right;">
                             <apex:outputPanel rendered="{!(forecast.MyBestcaseOverriden)}">
                                 <img title="{!forecast.mgrBestcaseOverrideNotes}"  src="/img/mgr_override.gif"/>
                             </apex:outputpanel>
                             <apex:outputText style="white-space:nowrap;text-align: right;" value="${0, number,###,###,###,##0.00}">
                                <apex:param value="{!forecast.bestCaseOverrideAmount}" />
                             </apex:outputText>
                             <apex:outputPanel id="refPnl1"> 
                                 <apex:commandLink style="float: right;"  action="{!showOverridePopup}" rendered="{!(forecast.forOverride)}" rerender="ovrpopup">
                                    <img src="/img/forecast_edit_off.gif" alt="Click to Override (New Window)" width="25" height="16" title="Click to Override (New Window)"/>    
                                        <apex:param name="orgamt"  value="{!forecast.bestcaseOverrideAmount}"  assignTo="{!originalAmount}"/>
                                        <apex:param name="orgOldamt"  value="{!forecast.bestcaseAmount}"  assignTo="{!originaloldAmount}"/>
                                        <apex:param name="lineitem"  value="{!forecast.strLineItmId}"  assignTo="{!strRecordId}"/>
                                        <apex:param name="lineowner"  value="{!forecast.UserId}"  assignTo="{!lineItemownerID}"/>                                        
                                        <apex:param name="ovrType"  value="bestcase"  assignTo="{!strField}"/>
                                 </apex:commandLink>
                                 
                              </apex:outputPanel>
                         </span>
                     </apex:column>
                      
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;text-align:center; width:12%;', 'text-align:center; width:12%')}">
                         <apex:facet name="header" >
                              <apex:outputText style="white-space:pre-wrap; float: right; height:20px;width:110px" value="My Direct Reports' Best Case " />         
                         </apex:facet>
                         <apex:outputText title="Previous Amount: ${!forecast.prevVFDirectRepbestcaseAmount}" style="white-space:nowrap;float: right;color:blue;font-weight:bold;" rendered="{!(NOT(forecast.searchUser && forecast.bestcaseAmount>0) &&(forecast.MyBestcaseOverriden && forecast.bestcasePreviousAmountMatch))}" value="${0, number,###,###,###,##0.00}">
                            <apex:param value="{!forecast.bestcaseAmount}"/>
                         </apex:outputText>

                         <apex:outputText style="float: right;" value="${0, number,###,###,###,##0.00}" rendered="{!NOT(forecast.searchUser && forecast.bestcaseAmount>0) && NOT(forecast.MyBestcaseOverriden && forecast.bestcasePreviousAmountMatch)}">
                             <apex:param value="{!forecast.bestCaseAmount}" />
                         </apex:outputText>
                         <apex:commandLink rendered="{!((forecast.searchUser)&& forecast.bestcaseAmount>0)}"  action="{!showDrilDownPopup}" rerender="drldwnpopup" >
                                  <apex:outputText style="text-decoration: underline;float: right;" value="${0, number,###,###,###,##0.00}">
                                    <apex:param value="{!forecast.bestCaseAmount}"/>
                                 </apex:outputText>
                                  <apex:param name="lineowner1"  value="{!forecast.UserId}"  assignTo="{!lineItemownerID}"/>                                        
                                 <apex:param name="ovrType2"  value="Best Case"  assignTo="{!strField}"/>
                          </apex:commandLink> 
                     </apex:column>
                    
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;', '')}">
                         <apex:facet name="header">
                              <apex:outputText style="white-space:pre-wrap; float: right;width:100px" value="Pipeline" />         
                         </apex:facet>  
                         <apex:outputText style="white-space:nowrap;float: right;" rendered="{!NOT(forecast.searchUser && forecast.pipelineAmount>0)}" value="${0, number,###,###,###,##0.00}"> 
                               <apex:param value="{!forecast.pipelineAmount}" />
                         </apex:outputText>
                         <apex:commandLink rendered="{!((forecast.searchUser)&& forecast.pipelineAmount>0)}"  action="{!showDrilDownPopup}" rerender="drldwnpopup" >
                                  <apex:outputText style="text-decoration: underline;float: right;" value="${0, number,###,###,###,##0.00}">
                                    <apex:param value="{!forecast.pipelineAmount}"/>
                                  </apex:outputText>  
                                  <apex:param name="lineowner1"  value="{!forecast.UserId}"  assignTo="{!lineItemownerID}"/>                                        
                                 <apex:param name="ovrType2"  value="Pipeline"  assignTo="{!strField}"/>
                          </apex:commandLink>
                         
                     </apex:column>
                    
                     <apex:column style="{!IF(CONTAINS(forecast.userName,"Total"), 'background-color:#5C94BE;color:white;font-weight:bold;', '')}">
                         <apex:facet name="header">
                              <apex:outputText style="white-space:pre-wrap; float: right;width:100px" value="Quota" />         
                         </apex:facet>  
                         <apex:outputText style="white-space:nowrap;float: right;" rendered="true" value="${0, number,###,###,###,##0.00}"> 
                               <apex:param value="{!forecast.quotaAmount}" />
                         </apex:outputText>
                     </apex:column> 
                </apex:dataTable>
                
            </apex:pageBlockSection>   
       </apex:pageBlock>
       </apex:form>
</apex:page>